import { Meta } from '@storybook/addon-docs/blocks';
import { Typography, Card, Space, List, Alert, Divider, Button } from 'antd';

<Meta title="React/Notification" />

<div style={{ padding: '24px' }}>
  <Space direction="vertical" size="large" style={{ width: '100%' }}>
    <div>
      <Typography.Title level={1}>
        ğŸ”” Notification é€šçŸ¥ä¸­å¿ƒ
      </Typography.Title>
      <Typography.Text>
        ç»Ÿä¸€çš„é€šçŸ¥æ¨é€è§£å†³æ–¹æ¡ˆï¼Œæ”¯æŒå¤šæ¸ é“é€šçŸ¥ã€äº‹ä»¶æ€»çº¿ã€è·¨æ ‡ç­¾é¡µåŒæ­¥
      </Typography.Text>
    </div>

    <Alert
      message="ğŸš€ æ ¸å¿ƒç‰¹æ€§"
      description="åŸºäº EventBus çš„é€šçŸ¥äº‹ä»¶æµã€å¤šæ¸ é“æ”¯æŒã€æµè§ˆå™¨åŸç”Ÿé€šçŸ¥ APIã€è·¨ç»„ä»¶/è·¨æ ‡ç­¾é¡µé€šä¿¡"
      type="success"
      showIcon
    />

    <Card>
      <Typography.Title level={4}>ğŸ“¦ æ¨¡å—ç»„æˆ</Typography.Title>
      <List
        size="small"
        bordered
        dataSource={[
          '**NotificationCenter** - é€šçŸ¥ä¸­å¿ƒå•ä¾‹ï¼Œç®¡ç†é€šçŸ¥å‘å¸ƒå’Œè®¢é˜…',
          '**NotificationChannel** - é€šçŸ¥æ¸ é“æ¥å£ï¼Œæ”¯æŒè‡ªå®šä¹‰å®ç°',
          '**channelRegistry** - æ¸ é“æ³¨å†Œè¡¨ï¼Œç®¡ç†å¯ç”¨æ¸ é“',
          '**BROWSER_NOTIFICATION_TYPE** - æµè§ˆå™¨é€šçŸ¥æ¸ é“å¸¸é‡'
        ]}
        renderItem={(item) => <List.Item><span dangerouslySetInnerHTML={{ __html: item }} /></List.Item>}
      />
    </Card>

    <Card>
      <Typography.Title level={4}>âš¡ å¿«é€Ÿå¼€å§‹</Typography.Title>
      <Typography.Paragraph>
        NotificationCenter æ˜¯å…¨å±€å•ä¾‹ï¼Œé€šè¿‡ publish æ–¹æ³•å‘é€é€šçŸ¥
      </Typography.Paragraph>
      <pre style={{
        background: '#f6f8fa',
        border: '1px solid #d1d9e0',
        borderRadius: '6px',
        padding: '16px',
        overflow: 'auto',
        fontFamily: 'SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace',
        fontSize: '13px'
      }}>{`import { notificationCenter } from '@ahoo-wang/fetcher-react';

// å‘é€æµè§ˆå™¨é€šçŸ¥
await notificationCenter.publish('browser', {
  title: 'æç¤º',
  payload: {
    body: 'è¿™æ˜¯ä¸€æ¡é€šçŸ¥æ¶ˆæ¯',
    icon: '/icon.png',
    tag: 'msg-1'
  }
});`}</pre>
    </Card>

    <Card>
      <Typography.Title level={4}>ğŸ”Œ API å‚è€ƒ</Typography.Title>
      
      <Typography.Title level={5}>notificationCenter.publish(type, message)</Typography.Title>
      <Typography.Paragraph>å‘å¸ƒé€šçŸ¥äº‹ä»¶åˆ°äº‹ä»¶æ€»çº¿ï¼Œè§¦å‘å¯¹åº”æ¸ é“å‘é€é€šçŸ¥</Typography.Paragraph>
      <List
        size="small"
        bordered
        dataSource={[
          '@param type - é€šçŸ¥æ¸ é“ç±»å‹ï¼Œå¦‚ "browser"',
          '@param message - é€šçŸ¥æ¶ˆæ¯å¯¹è±¡ { title, payload, onClick? }',
          '@returns Promise<void>'
        ]}
        renderItem={(item) => <List.Item style={{ fontFamily: 'monospace' }}>{item}</List.Item>}
        style={{ marginBottom: 16 }}
      />

      <Typography.Title level={5}>notificationCenter.eventBus</Typography.Title>
      <Typography.Paragraph>äº‹ä»¶æ€»çº¿å®ä¾‹ï¼Œç”¨äºè®¢é˜…é€šçŸ¥äº‹ä»¶</Typography.Paragraph>
      <List
        size="small"
        bordered
        dataSource={[
          'on(handler) - è®¢é˜…é€šçŸ¥äº‹ä»¶',
          'off(name) - å–æ¶ˆè®¢é˜…',
          'emit(event) - å‘å¸ƒäº‹ä»¶',
          'destroy() - é”€æ¯äº‹ä»¶æ€»çº¿'
        ]}
        renderItem={(item) => <List.Item>{item}</List.Item>}
        style={{ marginBottom: 16 }}
      />

      <Typography.Title level={5}>notificationCenter.destroy()</Typography.Title>
      <Typography.Paragraph>é”€æ¯é€šçŸ¥ä¸­å¿ƒï¼Œç§»é™¤æ‰€æœ‰è®¢é˜…å¹¶é‡Šæ”¾èµ„æº</Typography.Paragraph>
    </Card>

    <Card>
      <Typography.Title level={4}>ğŸŒ æµè§ˆå™¨é€šçŸ¥</Typography.Title>
      <Typography.Paragraph>
        ä½¿ç”¨æµè§ˆå™¨åŸç”Ÿ Notification APIï¼Œéœ€è¦ç”¨æˆ·æˆæƒæƒé™
      </Typography.Paragraph>
      <pre style={{
        background: '#f6f8fa',
        border: '1px solid #d1d9e0',
        borderRadius: '6px',
        padding: '16px',
        overflow: 'auto',
        fontFamily: 'SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace',
        fontSize: '13px'
      }}>{`import { 
  notificationCenter, 
  BROWSER_NOTIFICATION_TYPE 
} from '@ahoo-wang/fetcher-react';

// å‘é€æµè§ˆå™¨é€šçŸ¥
await notificationCenter.publish(BROWSER_NOTIFICATION_TYPE, {
  title: 'æ–°æ¶ˆæ¯',
  payload: {
    body: 'æ‚¨æœ‰æ–°çš„æœªè¯»æ¶ˆæ¯',
    icon: '/favicon.ico',
    tag: 'message-123',
    requireInteraction: true
  },
  onClick: () => {
    console.log('é€šçŸ¥è¢«ç‚¹å‡»');
  }
});`}</pre>
    </Card>

    <Card>
      <Typography.Title level={4}>ğŸ”§ æ‰©å±•è‡ªå®šä¹‰æ¸ é“</Typography.Title>
      <Typography.Paragraph>
        å¯ä»¥æ³¨å†Œè‡ªå®šä¹‰çš„é€šçŸ¥æ¸ é“ï¼Œæ”¯æŒé‚®ä»¶ã€çŸ­ä¿¡ã€Slack ç­‰
      </Typography.Paragraph>
      <pre style={{
        background: '#f6f8fa',
        border: '1px solid #d1d9e0',
        borderRadius: '6px',
        padding: '16px',
        overflow: 'auto',
        fontFamily: 'SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace',
        fontSize: '13px'
      }}>{`import { 
  channelRegistry, 
  NotificationChannel,
  Message 
} from '@ahoo-wang/fetcher-react';

// å®šä¹‰è‡ªå®šä¹‰æ¸ é“
class SlackChannel implements NotificationChannel {
  async send(message: Message): Promise<void> {
    // è°ƒç”¨ Slack Webhook å‘é€é€šçŸ¥
    await fetch('https://slack.com/webhook', {
      method: 'POST',
      body: JSON.stringify({ text: message.title })
    });
  }
}

// æ³¨å†Œæ¸ é“
channelRegistry.register('slack', new SlackChannel());

// ä½¿ç”¨è‡ªå®šä¹‰æ¸ é“
await notificationCenter.publish('slack', {
  title: 'ç³»ç»Ÿå‘Šè­¦',
  payload: { level: 'warning' }
});`}</pre>
    </Card>

    <Card>
      <Typography.Title level={4}>ğŸ“± æ¸ é“æ³¨å†Œè¡¨ API</Typography.Title>
      
      <Typography.Title level={5}>channelRegistry.register(type, channel)</Typography.Title>
      <List
        size="small"
        bordered
        dataSource={[
          'æ³¨å†Œæ–°çš„é€šçŸ¥æ¸ é“',
          '@param type - æ¸ é“ç±»å‹æ ‡è¯†ç¬¦',
          '@param channel - NotificationChannel å®ä¾‹',
          '@throws é‡å¤æ³¨å†Œæ—¶æŠ›å‡º Error'
        ]}
        renderItem={(item) => <List.Item style={{ fontFamily: 'monospace' }}>{item}</List.Item>}
        style={{ marginBottom: 12 }}
      />

      <Typography.Title level={5}>channelRegistry.unregister(type)</Typography.Title>
      <List
        size="small"
        bordered
        dataSource={[
          'æ³¨é”€æŒ‡å®šæ¸ é“'
        ]}
        renderItem={(item) => <List.Item>{item}</List.Item>}
        style={{ marginBottom: 12 }}
      />

      <Typography.Title level={5}>channelRegistry.get(type)</Typography.Title>
      <List
        size="small"
        bordered
        dataSource={[
          'è·å–æŒ‡å®šæ¸ é“ï¼Œä¸å­˜åœ¨è¿”å› undefined'
        ]}
        renderItem={(item) => <List.Item>{item}</List.Item>}
        style={{ marginBottom: 12 }}
      />

      <Typography.Title level={5}>channelRegistry.has(type)</Typography.Title>
      <List
        size="small"
        bordered
        dataSource={[
          'æ£€æŸ¥æ¸ é“æ˜¯å¦å·²æ³¨å†Œ'
        ]}
        renderItem={(item) => <List.Item>{item}</List.Item>}
      />
    </Card>

    <Card>
      <Typography.Title level={4}>âš›ï¸ useNotificationCenter Hook</Typography.Title>
      <Typography.Paragraph>
        React Hookï¼Œç”¨äºåœ¨ç»„ä»¶ä¸­å‘é€é€šçŸ¥æˆ–è®¢é˜…é€šçŸ¥äº‹ä»¶ï¼Œè‡ªåŠ¨ç®¡ç†è®¢é˜…ç”Ÿå‘½å‘¨æœŸ
      </Typography.Paragraph>
      
      <Typography.Title level={5}>åŸºæœ¬ç”¨æ³•</Typography.Title>
      <pre style={{
        background: '#f6f8fa',
        border: '1px solid #d1d9e0',
        borderRadius: '6px',
        padding: '16px',
        overflow: 'auto',
        fontFamily: 'SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace',
        fontSize: '13px'
      }}>{`import { useNotificationCenter } from '@ahoo-wang/fetcher-react';

function MyComponent() {
  const { send } = useNotificationCenter();

  const handleNotify = async () => {
    await send('browser', {
      title: 'æç¤º',
      payload: { body: 'æ¶ˆæ¯å†…å®¹' }
    });
  };

  return <button onClick={handleNotify}>å‘é€é€šçŸ¥</button>;
}`}</pre>

      <Typography.Title level={5}>ç›‘å¬é€šçŸ¥äº‹ä»¶</Typography.Title>
      <pre style={{
        background: '#f6f8fa',
        border: '1px solid #d1d9e0',
        borderRadius: '6px',
        padding: '16px',
        overflow: 'auto',
        fontFamily: 'SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace',
        fontSize: '13px'
      }}>{`import { useNotificationCenter } from '@ahoo-wang/fetcher-react';

function NotificationLogger() {
  const { subscribe, unsubscribe } = useNotificationCenter({
    channelType: 'browser',
    onNotification: (event) => {
      console.log('æ”¶åˆ°é€šçŸ¥:', event.message.title);
    }
  });

  // ç»„ä»¶æŒ‚è½½æ—¶è‡ªåŠ¨è®¢é˜…ï¼Œå¸è½½æ—¶è‡ªåŠ¨å–æ¶ˆ
  useEffect(() => {
    subscribe();
    return () => unsubscribe();
  }, []);

  return <div>ç›‘å¬é€šçŸ¥ä¸­...</div>;
}`}</pre>

      <Typography.Title level={5}>API</Typography.Title>
      <List
        size="small"
        bordered
        dataSource={[
          'send(type, message) - å‘é€é€šçŸ¥',
          'subscribe() - æ‰‹åŠ¨è®¢é˜…',
          'unsubscribe() - æ‰‹åŠ¨å–æ¶ˆè®¢é˜…'
        ]}
        renderItem={(item) => <List.Item>{item}</List.Item>}
      />
    </Card>

    <Card>
      <Typography.Title level={4}>âš ï¸ æ³¨æ„äº‹é¡¹</Typography.Title>
      <List
        size="small"
        dataSource={[
          'æµè§ˆå™¨é€šçŸ¥éœ€è¦ç”¨æˆ·æˆæƒæƒé™æ‰èƒ½æ­£å¸¸æ˜¾ç¤º',
          'Notification API éœ€è¦åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ (HTTPS) æˆ– localhost ä¸­ä½¿ç”¨',
          'é¡µé¢å¸è½½æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨ destroy() é‡Šæ”¾èµ„æº',
          'æ¨èåœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨ useNotificationCenter hook è®¢é˜…é€šçŸ¥',
          'è·¨æ ‡ç­¾é¡µé€šä¿¡ä¾èµ– BroadcastChannel API'
        ]}
        renderItem={(item) => <List.Item><span dangerouslySetInnerHTML={{ __html: item }} /></List.Item>}
      />
    </Card>

  </Space>
</div>
